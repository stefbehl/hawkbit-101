<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Eclipse hawkBit101 Tutorial</title>

    <meta name="description" content="Eclipse hawkBit 101">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/hawkBit.css" id="theme">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

    <style>
      .hawkbit101 .reveal h1 {
        color: #572564;
      }
      .hawkbit101 .reveal li {
        margin: 0.4em 0;
      }
      .hawkbit101 .reveal li > div + div {
        margin-top: 0.2em;
      }
      .hawkbit101 .two-columns-eq {
      	display: grid;
      	grid-template-columns: 1fr 1fr;
      	grid-gap: 0 1em;
      }
      .hawkbit101 .two-columns-eq > * {
        overflow: hidden;
      }
      .hawkbit101 .reveal pre {
        width: 100%; 
        box-shadow: none;     
      }
      .hawkbit101 blockquote {
        width: 80%;
        border: 0;
        box-shadow: none;
        background-color: #f6f0f8;
      }
      .hawkbit101 blockquote.verify {
        font-style: italic;
        text-align: center;
      }
      .hawkbit101 .current-page {
        position: absolute;
        top: 0;
        right: 0;
      }
      .hawkbit101 .api {
        display: inline-block;
        float: right;
        padding: 4px 8px;
        color: #fff;
        margin-top: 10px;
      }      
      .hawkbit101 .api.mgmt {
        background-color: green;
      }
      .hawkbit101 .api.ddi {
        background-color: #21aee6;
      }
      .hawkbit101 .api.sim {
        background-color: gray;
      }
      .hawkbit101 .reveal img {
        border: 0;
        box-shadow: none;
      }
      .hawkbit101 .api-request {
        position: relative;
      }
      .hawkbit101 .copy-to-clipboard {
        position: absolute;
        top: 0;
        right: 0;
      }     
      .hawkbit101 .copy-to-clipboard textarea {
        position: absolute;
        top: -9999px;
      }
      .hawkbit101 .copy-to-clipboard input[type='submit'],
      .hawkbit101 .copy-to-clipboard-link {
        border: 0;
        background: none;
        color: #6eb553;
      }
      .hawkbit101 .copy-to-clipboard input[type='submit']:hover,
      .hawkbit101 .copy-to-clipboard input[type='submit']:active {
        text-decoration: underline;
        cursor: pointer;    
      }
      .hawkbit101 .set-target-token input[type='submit'] {
        background-color: #f6f0f8;
        border: 1px solid #a58dda;
        color: #551f62;
        margin-left: 10px;
        padding: 4px 8px;
        cursor: pointer;
      }
      .hawkbit101 .set-target-token input[type='submit']:hover,
      .hawkbit101 .set-target-token input[type='submit']:active {
        background-color: #efdff5;
      }      
      .hawkbit101 .set-target-token input[type='text'] {
        background-color: #faf7fa;
        border: none;
        border-bottom: 1px solid #a58dda;
        padding: 4px 8px;
      }
     </style>

    <body class="hawkbit101">
        <div class="reveal">
            <div class="slides">
            
                <section data-background-image="https://images.unsplash.com/photo-1496867557017-559adb93b339?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=1304bcfdaa956c3acad348d06ff059e3&auto=format">
                    <div style="color: white; margin-left: 15em; margin-top: 2em;">
                        <h1 style="font-size: 4em">hawkBit-101</h1>
                        <h3>&nbsp;Tutorial @ EclipseCon Europe 2018</h3>
                    </div>
                    <div class="footer" style="position: fixed; bottom: 0; right: 0; text-align: right;">
                      Photo by <a href="https://unsplash.com/photos/zb2vBaHYB2I">Dawid Zawi≈Ça</a> on <a href="https://unsplash.com">Unsplash</a>
                    </div>
                </section>
                
                <section>
                  <h1>Who we are</h1>
                    <div style="font-size: 1.5em; position:absolute; left:2em; width: 100%;">
                      <div style="display: inline-block;">
                        <a href="https://github.com/stefbehl"><img src="https://avatars2.githubusercontent.com/u/16321153?s=120&v=4" style="border-radius: 50%;" align="left"></a>
                        <p style="margin-left: 5em; margin-top: 1.2em;">Stefan Behl</p>
                      </div>
                      <br>
                      <div style="display: inline-block;">
                        <a href="https://github.com/schabdo"><img src="https://avatars1.githubusercontent.com/u/18215905?s=120&v=4" style="border-radius: 50%;" align="left"></a>
                        <p style="margin-left: 5em; margin-top: 1.2em;">Dominic Schabel</p>
                      </div>
                    </div>
                </section>
                
                <section data-background-image="https://images.unsplash.com/photo-1514388614019-c755c395185c?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=52ee84aaf0d189ef9efa9a80ae411457&auto=format&fit=crop&w=1050&q=80">
                  <h1 style="color: white;">Who are you?</h1>
                  <div class="footer" style="position: fixed; bottom: 0; right: 0; text-align: right;">
                    Photo by <a href="https://unsplash.com/photos/KPydzVyWfqg">Christian Chen</a> on <a href="https://unsplash.com">Unsplash</a>
                  </div>
                </section>
                
                <section>
                    <h1>Today's mission</h1>
                    <ul style="position:absolute; left:2em;">
                      <li>Welcome</li>
                      <li>Intro hawkBit</li>
                      <li>Tutorial setup</li>
                      <li>All things hawkBit</li>
                      <li>Q&nbsp;&&nbsp;A</li>
                    </ul>
                </section>
                
                <section>
                    <h1>About</h1>
                    <p>
                      Eclipse hawkBit aims to create a <b>domain-independent</b> backend solution for rolling out <b>software updates</b>
                      to constrained edge devices as well as more powerful controllers and gateways connected to IP based networking infrastructure.
                    </p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: repeat(4, 1fr); margin-top: 4em; grid-gap: 40px">
                      <div style="justify-self: center;"><i class="fas fa-microchip fa-2x"></i></div>
                      <div style="justify-self: center;"><i class="fas fa-server fa-2x"></i></div>
                      <div style="justify-self: center;">specific</div>
                      <div style="justify-self: center;">independent</div>
                   </div>
                </section>
                
                <section>
                  <h1>Update Package</h1>
                  <div class="noborder" style="margin-top: 4em;">
                    <img src="resources/images/packagemodel.png">
                  </div>
                </section>
                
                <section>
                  <h1>Big Picture</h1>
                  <img src="resources/images/hawkBit_overview.jpg">
                </section>
                
                <section>
                  <h1>Tutorial Overview</h1>
                  <div class="two-columns-eq" style="grid-template-columns: 2fr 3fr">                  
                    <ol style="overflow: inherit">
                      <li>Provisioning a device</li>
                      <li>Creating an update</li>
                      <li>Updating a single device</li>
                      <li>Updating many devices</li>
                    </ol>
                    <div>
                      <img style="max-width: 100%; max-height: 100%;" src="resources/images/hawkBit_tutorial_focusareas.jpg">
                    </div>
                  </div>
                </section>
                
                <section>
                  <h1>Tutorial Resources</h1>
                  <div>All resources are available in the hawkBit-101 Git repository</div>
                  <div><a target="_blank" href="https://github.com/stefbehl/hawkbit-101">https://github.com/stefbehl/hawkbit-101</a></div>
                  <br>
                  <div>Recommendation is to clone the repository</div>
                </section>
                
                <section>
                  <h1>Docker Setup</h1>
                  <p>
                    <a target="_blank" href="https://github.com/stefbehl/hawkbit-101/blob/master/setup/docker-compose-stack.yml">https://github.com/stefbehl/hawkbit-101/blob/master/setup/docker-compose-stack.yml</a>                      
                  </p>
                  <div style="display: grid; grid-template-columns: 40% 60%;">
                    <div>Services:
                      <ul>
                        <li>hawkBit Update Server v0.2.3</li>
                        <li>hawkBit Device Simulator</li>
                        <li>MySQL database</li>
                        <li>Rabbit MQ</li>
                      </ul>
                    </div>
                    <div class="api-request">
                      <form class="copy-to-clipboard" style="top:-10px" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">
                        docker swarm init
                        docker stack deploy -c docker-compose-stack.yml hawkbit</textarea>
                        <input type="submit" value="copy2clipboard">
                      </form>
                      <pre><code data-trim>
                        $ docker swarm init
                        [...]
                        $ docker stack deploy -c docker-compose-stack.yml hawkbit
                        Creating network hawkbit_hawknet
                        Creating service hawkbit_hawkbit
                        Creating service hawkbit_simulator
                        Creating service hawkbit_rabbitmq
                        Creating service hawkbit_mysql                          
                      </code></pre>
                    </div>                      
                  </div>
                </section>
                
                <section>
                  <h1>Setup Verification</h1>
                  <div class="two-columns-eq">
                    <div>
                      <h3>Update Server</h3>
                      <div><a target="_blank" href="http://localhost:8080">http://localhost:8080</a></div>
                      <div class="api-request">
                        <form class="copy-to-clipboard" style="top:-30px" onsubmit="return copyToClipboard(this.buffer)" action="#">
                    	  <textarea name="buffer">curl -i http://localhost:8080/health</textarea>
                          <input type="submit" value="copy2clipboard">
                        </form>
                        <pre><code data-trim>
                          $ curl http://localhost:8080/health
                          
                          {"status":"UP"}
                        </code></pre>
                      </div>
                    </div>
                    <div>
                      <h3>Device Simulator</h3>
                      <div><a target="_blank" href="http://localhost:8080">http://localhost:8083</a></div>
                      <div class="api-request">
                        <form class="copy-to-clipboard" style="top:-30px" onsubmit="return copyToClipboard(this.buffer)" action="#">
                    	  <textarea name="buffer">curl -i http://localhost:8083/health</textarea>
                          <input type="submit" value="copy2clipboard">
                        </form>
                        <pre><code data-trim>
                          $ curl http://localhost:8083/health
                          
                          {"status":"UP"}
                        </code></pre>
                      </div>
                      <div>In case of a broken simulator, restart the Docker container:</div>
                      <div class="api-request">
                        <form class="copy-to-clipboard" style="top:-30px" onsubmit="return copyToClipboard(this.buffer)" action="#">
                    	  <textarea name="buffer">docker service update --force hawkbit_simulator</textarea>
                          <input type="submit" value="copy2clipboard">
                        </form>
                        <pre><code data-trim>
                          $ docker service update --force hawkbit_simulator
                        </code></pre>
                      </div>
                    </div>
                  </div>                      
                </section>

                <section>
                  <h1>Execution</h1>
                  <div class="two-columns-eq">
                    <div>
                      <div>Execute the oulined steps via</div>
                      <ul>
                        <li>
                          <div>Inline <span class="copy-to-clipboard-link">curl2clipboard</span> links</div>
                        </li>
                        <li>
                          <div>curl snippets (copy&paste)</div>
                          <div><a target="_blank" href="https://github.com/stefbehl/hawkbit-101/blob/master/postman/hawkbit101.curl_snippets.txt">https://github.com/stefbehl/hawkbit-101/blob/master/postman/hawkbit101.curl_snippets.txt</a></div>
                        </li>
                        <li>
                          <div>Postman</div>
                          <div><a target="_blank" href="https://github.com/stefbehl/hawkbit-101/blob/master/postman/hawkbit101.postman_collection.json">https://github.com/stefbehl/hawkbit-101/blob/master/postman/hawkbit101.postman_collection.json</a></div>
                        </li>
                      </ul>
                    </div>
                    <div>                      
                      <div>Open in your browser</div>
                      <ul>
                        <li>
                          <div>Tutorial slides</div>
                          <div><a href="https://stefbehl.github.io/hawkbit-101/">https://stefbehl.github.io/hawkbit-101/</a></div>
                        </li>
                        <li>
                          <div>hawkBit Update Server UI</div>
                          <div><a target="_blank" href="http://localhost:8080">http://localhost:8080</a></div>
                          <div>admin /admin</div>
                        </li>
                        <li>
                          <div>hawkBit API documentation</div>
                          <div><a target="_blank" href="https://www.eclipse.org/hawkbit/apis/">https://www.eclipse.org/hawkbit/apis/</a></div>
                        </li>
                      </ul>
                    </div>
                  </div><br>
                  <blockquote class="verify" style="font-size: 1.5em">Talk to us if you need help!</blockquote>
                </section>
                
                <section>
                  <h6>Part 1</h6>
                  <h1>Provisioning a Device</h1>
                  <div>
                  	<ul>
                  	  <li>Configure target token authentication</li>
                      <li>Provisioning a device</li>
                      <li>Registering a device</li>
                      <li>Setting device attributes</li>
                  	</ul>
                  </div>
                </section>

                <section>
                  <div class="current-page">
                    <div>Part 1, step 1</div>
                    <div class="api mgmt">Mgmt API</div>
                  </div>
                  <h2>Enable Target Token Authentication</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X PUT 'http://localhost:8080/rest/v1/system/configs/authentication.targettoken.enabled/' -u 'admin:admin' -H 'Content-Type: application/json' -d '{"value": true}'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP PUT
                        /rest/v1/system/configs/authentication.targettoken.enabled
                          
                        Accept: application/hal+json
                        Authorization: Basic admin:admin
                        Content-Type: application/json
                        Body:
                        {
                          "value": true
                        }
                      </code></pre>
                    </div>
                    <div class="api-response">
                      <div>Response</div>
                      <pre><code class="json" data-trim>
                        HTTP/1.1 200 OK
                        {
                          "value": true,
                          "lastModifiedAt": 1539767150967,
                          "lastModifiedBy": "admin",
                          "createdAt": 1539767150967,
                          "createdBy": "admin",
                          "global": false,
                          "_links": {
                            "self": {
                              "href": "/rest/v1/system/configs/authentication.targettoken.enabled"
                            }
                          }
                        }
                        </code></pre>
                    </div>
                  </div>
                  <blockquote class="verify">Verify in the System Configuration view of the UI that target token authentication is enabled.</blockquote>
                </section>
                
                <section>
                  <div class="current-page">
                    <div>Part 1, step 2</div>
                    <div class="api mgmt">Mgmt API</div>
                  </div>
                  <h2>Device Pre-Provisioning</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X POST 'http://localhost:8080/rest/v1/targets' -u 'admin:admin' -H 'Content-Type: application/json' -d '[{"controllerId": "dev01", "name": "Device 01", "description": "My first device"}]'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP POST
                        /rest/v1/targets
                          
                        Accept: application/hal+json
                        Authorization: Basic admin:admin
                        Content-Type: application/json
                        Body:
                        [{
                          "controllerId": "dev01",
                          "name": "Device 01",
                          "description": "My first device"
                        }]
                      </code></pre>
                      <p>The response contains the security token that can be used by the device to authenticate via DDI:<br><form class="set-target-token" action="#" onsubmit="localStorage.setItem('REPLACE_WITH_TARGET_TOKEN', this.targetToken.value); alert('Target token successfully set'); return false;"><input type="text" name="targetToken"><input type="submit" value="Set Target Token"></form></p>
                    </div>
                    <div class="api-response">
                      <div>Response</div>
                      <pre><code class="json" data-trim>
                        HTTP/1.1 201 Created
                        [{
                          "controllerId": "dev01",
                          "createdBy": "admin",
                          "createdAt": 1539089120222,
                          "lastModifiedBy": "admin",
                          "lastModifiedAt": 1539089120222,
                          "name": "Device 01",
                          "description": "My first device",
                          "updateStatus": "unknown",
                          "securityToken": "742f7f594c157f5885a8c5fbabcb84dd",
                          "requestAttributes": true,
                          "_links": {
                            "self": {
                              "href": "/rest/v1/targets/dev01"
                            }
                          }
                        }]
                      </code></pre>
                    </div>
                  </div>
                  <blockquote class="verify">Verify in the Deployment Management view of the UI that the target has been created. Create another target via the UI.</blockquote>
                </section>
                
                <section>
                  <div class="current-page">
                    <div>Part 1, step 3</div>
                    <div class="api ddi">DDI API</div>
                  </div>
                  <h2>Device Registration</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X GET 'http://localhost:8080/DEFAULT/controller/v1/dev01' -H 'Authorization: TargetToken REPLACE_WITH_TARGET_TOKEN'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                          HTTP GET
                          /DEFAULT/controller/v1/{controllerId}
                          
                          Accept: application/hal+json
                          Authorization: TargetToken {targetToken}
                      </code></pre>
                      <p>The very first time the device "connects" via DDI is used for registering the device.</p>
                      <p>The response contains a "configData" link to set device attributes (via HTTP PUT).</p>
                    </div>
                    <div class="api-response">
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 200 OK
                        {
                          "config": {
                            "polling": {
                              "sleep": "00:05:00"
                            }
                          },
                          "_links": {
                            "configData": {
                              "href": "/DEFAULT/controller/v1/dev01/configData"
                            }
                          }
                        }
                      </code></pre>
                    </div>
                  </div>
                  <blockquote class="verify">Verify in the Deployment Management view of the UI that the state of the target changed from UNKNOWN to REGISTERED.<br>OK, this one is really hard... :-)</blockquote>                  
                </section>
                
                <section>
                  <div class="current-page">
                    <div>Part 1, step 4</div>
                    <div class="api ddi">DDI API</div>
                  </div>
                  <h2>Setting Device Attributes</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X PUT 'http://localhost:8080/DEFAULT/controller/v1/dev01/configData' -H 'Authorization: TargetToken REPLACE_WITH_TARGET_TOKEN' -H 'Content-Type: application/json' \-d '{"mode": "merge", "data": {"VIN": "JH4TB2H26CC000001", "hwRevision": "1"}, "status": {"result": {"finished": "success"}, "execution": "closed", "details": []}}'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP PUT
                        /DEFAULT/controller/v1/{controllerId}/configData
                        
                        Accept: application/hal+json
                        Authorization: TargetToken {targetToken}
                        Content-Type: application/json
                        Body:
                        {
                          "mode": "merge",
                          "data": {
                            "VIN": "JH4TB2H26CC000001",
                            "hwRevision": "1"
                          },
                          "status": {
                            "result": {
                              "finished": "success"
                            },
                            "execution": "closed",
                            "details": []
                          }
                        }'
                      </code></pre>
                    </div>
                    <div class="api-response">
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 200 OK
                      </code></pre>
                      <p>Once the device has sent its attributes, the "configData" link is no longer exposed.</p>
                      <p>You can instruct the device to re-send its (potentially updated) attributes via the UI and Mgmt API.</p>
                    </div>
                  </div>
                  <blockquote class="verify">Verify in the Deployment Management view of the UI that the device attributes are present.</blockquote>                  
                </section>
                
                <section>
                  <h6>Part 2</h6>
                  <h1>Creating an Update</h1>
                  <div>
                  	<ul>
                      <li>Creating a software module</li>
                      <li>Uploading an artifact</li>
                      <li>Creating a distribution set</li>
                      <li>Assigning the software module to the distribution set</li>
                  	</ul>
                  </div>
                </section>
                
                <section>
                  <div class="current-page">
                    <div>Part 2, step 1</div>
                    <div class="api mgmt">Mgmt API</div>
                  </div>
                  <h2>Creating a Software Module</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X POST 'http://localhost:8080/rest/v1/softwaremodules' -u 'admin:admin' -H 'Content-Type: application/json' -d '[{"vendor": "Example Ltd.", "name": "MyOS", "description": "First version of MyOS.", "type": "os", "version": "1.0"}]'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP POST
                        /rest/v1/softwaremodules
                        
                        Accept: application/hal+json
                        Authorization: Basic admin:admin
                        Content-Type: application/json
                        Body:
                        [{
                          "vendor": "Example Ltd.",
                          "name": "MyOS",
                          "description": "First version of MyOS.",
                          "type": "os",
                          "version": "1.0"
                        }]
                      </code></pre>
                      <p>This will create an "empty" software module of type "OS". Next we will add artifacts to the module.</p>
                    </div>
                    <div class="api-response">
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 201 CREATED
                        [{
                          [...]
                          "id": 2
                          "name": "MyOS",
                          "description": "First version of MyOS.",
                          "version": "1.0",
                          "type": "os",
                          "vendor": "Example Ltd.",
                          "deleted": false,
                          "_links": {
                            "self": {
                              "href": "/rest/v1/softwaremodules/2"
                            }
                          }
                        }]
                      </code></pre>
                    </div>
                  </div>
                  <blockquote class="verify">Verify in the Distribution Management view of the UI that the software module has been created. Create another software module of type "Application" via the UI.</blockquote>                  
                </section>

                <section>
                  <div class="current-page">
                    <div>Part 2, step 2</div>
                    <div class="api mgmt">Mgmt API</div>
                  </div>
                  <h2>Uploading an Artifact</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">echo "This is a test update file." > artifact01.file
                        curl -i -X POST 'http://localhost:8080/rest/v1/softwaremodules/1/artifacts' -u 'admin:admin' -H 'Content-Type: multipart/form-data' -F 'file=@artifact01.file'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP POST
                        /rest/v1/softwaremodules/{moduleId}/artifacts
                        
                        Accept: application/hal+json
                        Authorization: Basic admin:admin
                        Content-Type: multipart/form-data;
                          boundary=6o2knFse3p53ty9dmcQvWAIx1zInP11uCfbm
                        Body:
                        --6o2knFse3p53ty9dmcQvWAIx1zInP11uCfbm
                        Content-Disposition: form-data; name=artifact01.file
                        [...]
                      </code></pre>
                      <p>The uploaded artifact will be associated with the specified software module. The response provides a download link.</p>
                    </div>
                    <div class="api-response">
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 201 CREATED
                        {
                          [...]
                          "id": 2,
                          "hashes": {
                            "sha1": "d2e7291c2c52b87b2ee00983217e1bcc0909251f",
                            "md5": "b14f29fe8cea6b25e62a8e5c48b5a3a1"
                          },
                          "providedFilename": "artifact01.file",
                          "size": 28,
                          "_links": {
                            "self": {
                              "href": "/rest/v1/softwaremodules/2/artifacts/2"
                            },
                            "download": {
                              "href":
                                "/rest/v1/softwaremodules/2/artifacts/2/download"
                            }
                          }
                        }
                      </code></pre>
                    </div>
                  </div>
                  <blockquote class="verify">Verify in the Upload view of the UI that the artifact is associated with your software module. Upload another artifact for the same software module via the UI.</blockquote>                  
                </section>
                
                <section>
                  <div class="current-page">
                    <div>Part 2, step 3</div>
                    <div class="api mgmt">Mgmt API</div>
                  </div>
                  <h2>Creating a Distribution Set</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X POST 'http://localhost:8080/rest/v1/distributionsets' -u 'admin:admin' -H 'Content-Type: application/json' -d '[{"requiredMigrationStep": false, "name": "MyDS", "description": "My initial distribution", "type": "os", "version": "1.0"}]'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP POST
                        /rest/v1/distributionsets
                        
                        Accept: application/hal+json
                        Authorization: Basic admin:admin
                        Content-Type: application/json
                        Body:
                        [{
                          "requiredMigrationStep": false,
                          "name": "MyDS",
                          "description": "My initial distribution",
                          "type": "os",
                          "version": "1.0"
                        }]
                      </code></pre>
                      <p>Next we need to assign the previously created software module with the new distribution set.</p>
                    </div>
                    <div class="api-response">
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 201 CREATED
                        [{
                          [...]
                          "id": 2,
                          "name": "MyDS",
                          "description": "My initial distribution",
                          "version": "1.0",
                          "modules": [...],
                          "requiredMigrationStep": false,
                          "type": "os",
                          "complete": true,
                          "deleted": false,
                          "_links": {
                            "self": {
                              "href": "/rest/v1/distributionsets/2"
                            }
                          }
                        }]
                      </code></pre>
                    </div>
                  </div>
                  <blockquote class="verify">Verify in the Distribution Management view of the UI that the distribution set is created and the software module is assigned.</blockquote>                  
                </section>
                
                <section>
                  <div class="current-page">
                    <div>Part 2, step 4</div>
                    <div class="api mgmt">Mgmt API</div>
                  </div>
                  <h2>Assigning a Software Module</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X POST http://localhost:8080/rest/v1/distributionsets/1/assignedSM -u 'admin:admin' -H 'Content-Type: application/json' -d '[{"id": "1"}]'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP POST
                        /rest/v1/distributionsets/{distributionId}/assignedSM
                        
                        Authorization: Basic admin:admin
                        Content-Type: application/json
                        Body:
                        [{
                            "id": "{moduleId}"
                        }]'
                      </code></pre>
                      <p>Try to assign a software module of type "Application". Why does it fail?</p>
                    </div>
                    <div class="api-response">
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 200 OK
                      </code></pre>
                      <div>or</div>
                        <pre><code data-trim>
                        HTTP/1.1 400 Bad Request
                        {
                          "exceptionClass": "o.e.h.r.e.UnsupportedSoftwareModuleForThisDistributionSetException",
                          "errorCode": "hawkbit.server.error.distributionset.modules.unsupported",
                          "message": "Distribution set type does not contain the given module, i.e. is incompatible."
                        }
                      </code></pre>                        
                    </div>
                  </div>
                  <blockquote class="verify">Verify your software module assignments in the Distributions Management view of the UI. Review the properties of your distribution set, in particular its type.</blockquote>                  
                </section>
                
                <section>
                  <h6>Part 3</h6>
                  <h1>Updating a Single Device</h1>
                  <div>
                  	<ul>
                      <li>Assigning a distribution set to a device</li>
                      <li>Polling for updates</li>
                      <li>Inspecting the deployment action</li>
                      <li>Downloading artifacts</li>
                      <li>Providing deployment feedback</li>
                  	</ul>
                  </div>
                </section>
                
                <section>
                  <div class="current-page">
                    <div>Part 3, step 1</div>
                    <div class="api mgmt">Mgmt API</div>
                  </div>
                  <h2>Assigning a Distribution Set</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X POST http://localhost:8080/rest/v1/distributionsets/1/assignedTargets/ -u 'admin:admin' -H 'Content-Type: application/json' -d '[{"id" : "dev01", "type" : "forced"}]'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP POST
                        /rest/v1/distributionsets/{distributionId}/assignedTargets/
                        
                        Accept: application/hal+json
                        Authorization: Basic admin:admin
                        Content-Type: application/json
                        Body:
                        [{
                          "id" : "{targetId}",
                          "type" : "forced"
                        }]
                      </code></pre>
                      <p>The specified type "forced" instructs the device to apply the update immediately. Alternatives are "soft" and "timeforced".</p>
                    </div>
                    <div class="api-response">
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 200 OK
                        {
                          "assigned": 1,
                          "alreadyAssigned": 0,
                          "total":1
                        }
                      </code></pre>
                    </div>
                    <!--<div>As an alternative, you can also use the API entry point "/rest/v1/targets{{targetId}}/assignedDS" to update a single device.</div>-->
                  </div>
                  <blockquote class="verify">Verify in the Deployment Management view of the UI that a deployment action is listed in the action history of your device. Maximize the action history of your device.</blockquote>                  
                </section>
                
                <section>
                  <div class="current-page">
                    <div>Part 3, step 2</div>
                    <div class="api ddi">DDI API</div>
                  </div>
                  <h2>Polling for Updates</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X GET http://localhost:8080/DEFAULT/controller/v1/dev01 -H 'Authorization: TargetToken REPLACE_WITH_TARGET_TOKEN'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP GET
                        /DEFAULT/controller/v1/{controllerId}
                        
                        Accept: application/hal+json
                        Authorization: TargetToken {targetToken}
                      </code></pre>
                      <p>The response contains a "deploymentBase" link that can be used by the device to get all the information needed to process the assigned update.</p>
                    </div>
                    <div class="api-response">
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 200 OK
                        {
                          "config": {
                            "polling": {
                              "sleep": "00:05:00"
                            }
                          },
                          "_links": {
                            "deploymentBase": {
                              "href": "/DEFAULT/controller/v1/dev01/deploymentBase/1"
                            }
                          }
                        }
                        </code></pre>
                    </div>
                  </div>
                </section>
                
                <section>
                  <div class="current-page">
                    <div>Part 3, step 3</div>
                    <div class="api ddi">DDI API</div>
                  </div>
                  <h2>Inspecting the Deployment Action</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X GET http://localhost:8080/DEFAULT/controller/v1/dev01/deploymentBase/1?c=564904365 -H 'Authorization: TargetToken REPLACE_WITH_TARGET_TOKEN'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP GET
                        /DEFAULT/controller/v1/{controllerId}
                            /deploymentBase/{actionId}
                        
                        Accept: application/hal+json
                        Authorization: TargetToken {targetToken}
                      </code></pre>
                      <p>The response contains an array of chunks, each representing a software module. For each software module there is an array of artifacts providing the artifact download URLs and checksums.</p>
                    </div>
                    <div class="api-response">
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 200 OK
                        {
                          "id": "1",
                          "deployment": {
                            "download": "forced",
                            "update": "forced",
                            "chunks": [{
                              "part": "os",
                              "version": "1",
                              "name": "os1",
                              "artifacts": [{
                                "filename": "test_large.txt",
                                "hashes": {...},
                                "size": 3400321,
                                "_links": {
                                  "download-http": {
                                    "href": "/DEFAULT/controller/v1/dev01/softwaremodules/1/artifacts/test_large.txt"
                                  },
                                  "md5sum-http": {
                                    "href": "/DEFAULT/controller/v1/dev01/softwaremodules/1/artifacts/test_large.txt.MD5SUM"
                                  }
                                }
                              }
                            ]}
                          ]}
                        }
                        </code></pre>
                    </div>
                  </div>
                  <blockquote class="verify">Verify in the action history of the Deployment Management view that the update was retrieved by the device.</blockquote>                  
                </section>
                
                <section>
                  <div class="current-page">
                    <div>Part 3, step 4</div>
                    <div class="api ddi">DDI API</div>
                  </div>
                  <h2>Downloading an Artifact</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X GET http://localhost:8080/DEFAULT/controller/v1/dev01/softwaremodules/1/artifacts/artifact01.file -H 'Authorization: TargetToken REPLACE_WITH_TARGET_TOKEN'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP GET
                        /DEFAULT/controller/v1/{controllerId}
                            /softwaremodules/{moduleId}/artifacts/{filename}
                        
                        Authorization: TargetToken {targetToken}
                      </code></pre>
                      <p>You can configure that devices are allowed to download artifacts w/o providing a security token.</p>
                    </div>
                    <div class="api-response">
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 200 OK
                        
                        This is a test update file
                        </code></pre>
                    </div>
                  </div>
                  <blockquote class="verify">Verify in the action history of the Deployment Management view<br>that the device has downloaded the artifact.</blockquote>                  
                </section>
                
                <section>
                  <div class="current-page">
                    <div>Part 3, step 5.1</div>
                    <div class="api ddi">DDI API</div>
                  </div>
                  <h2>Providing Intermediary Feedback</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X POST http://localhost:8080/DEFAULT/controller/v1/dev01/deploymentBase/1/feedback -H 'Authorization: TargetToken REPLACE_WITH_TARGET_TOKEN' -H 'Content-Type: application/json' -d '{"id" : "1", "status" : {"result": {"progress": {"cnt": 2, "of": 5}, "finished": "none"}, "execution": "proceeding", "details": ["The update is being processed."]}}'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP POST
                        /DEFAULT/controller/v1/{controllerId}
                            /deploymentBase/{actionId}/feedback
                                                
                        Authorization: TargetToken {targetToken}
                        Content-Type: application/json
                        Body:
                        {
                          "id" : "{actionId}",
                          "status" : {
                            "result": {
                              "progress": {
                                "cnt": 2,
                                "of": 5
                              },
                              "finished": "none"
                            },
                            "execution": "proceeding",
                            "details": ["The update is being processed."]
                          }
                        }
                      </code></pre>
                    </div>
                    <div class="api-response">
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 200 OK
                      </code></pre>
                      <p>Devices can provide arbitrary feedback (e.g. fine granular progress updates) which does not cause state transitions in the deployment action workflow.</p>
                    </div>
                  </div>
                  <blockquote class="verify">Verify in the action history of the Deployment Management view that your progress message appears in the list. Send another feedback message.</blockquote>                  
                </section>
                
                <section>
                  <div class="current-page">
                    <div>Part 3, step 5.2</div>
                    <div class="api ddi">DDI API</div>
                  </div>
                  <h2>Providing Deployment Feedback</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X POST http://localhost:8080/DEFAULT/controller/v1/dev01/deploymentBase/1/feedback -H 'Authorization: TargetToken REPLACE_WITH_TARGET_TOKEN' -H 'Content-Type: application/json' -d '{"id" : "1", "status" : {"result" : {"finished" : "success"}, "execution" : "closed", "details" : ["The update was successfully installed."]}}'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP POST
                        /DEFAULT/controller/v1/{controllerId}
                            /deploymentBase/{actionId}/feedback
                        
                        Authorization: TargetToken {targetToken}
                        Content-Type: application/json
                        Body:
                        {
                          "id": "{actionId}",
                          "status": {
                            "result": {
                              "finished": "success"
                            },
                            "execution": "closed",
                            "details": ["The update was successfully installed."]
                          }                            
                        }
                      </code></pre>
                    </div>
                    <div class="api-response">
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 200 OK
                      </code></pre>
                      <p>This action finishes the deployment action workflow and pushes the action into state "Finished". Further feedback requests are rejected with "HTTP/1.1 410 GONE".</p>
                    </div>
                  </div>
                  <blockquote class="verify">Verify in the Deployment Management view of the UI that the deployment action is in state "Finished".</blockquote>                  
                </section>

                <section>
                  <h6>Part 4</h6>
                  <h1>Updating Many Devices</h1>
                  <div>
                  	<ul>
                  	  <li>Configure gateway token authentication</li>
                      <li>Provision many devices</li>
                      <li>Create a rollout</li>
                      <li>Start a rollout</li>
                  	</ul>
                  </div>
                </section>
                
                <section>
                  <div class="current-page">
                    <div>Part 4, step 1.1</div>
                    <div class="api mgmt">Mgmt API</div>
                  </div>
                  <h2>Enable Gateway Token Authentication</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X PUT http://localhost:8080/rest/v1/system/configs/authentication.gatewaytoken.enabled -u 'admin:admin' -H 'Content-Type: application/json' -d '{"value" : true}'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP PUT
                        /rest/v1/system/configs/authentication.gatewaytoken.enabled
                        
                        Accept: application/hal+json
                        Authorization: Basic admin:admin
                        Content-Type: application/json
                        Body:
                        {
                          "value" : true
                        }
                      </code></pre>
                      <p>This allows a gateway to authenticate on behalf of the devices that are connected to it. The device simulator acts like a gateway and relies on this authentication mechanism.</p>
                    </div>
                    <div class="api-response">
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 200 OK
                        {
                          "value": true,
                          "lastModifiedAt": 1539682103744,
                          "lastModifiedBy": "admin",
                          "createdAt": 1539682103744,
                          "createdBy": "admin",
                          "global": false,
                          "_links": {
                            "self": {
                              "href":
                                "/rest/v1/system/configs/authentication.gatewaytoken.enabled"
                            }
                          }
                        }
                      </code></pre>
                    </div>
                  </div>
                </section>
                
                <section>
                  <div class="current-page">
                    <div>Part 4, step 1.2</div>
                    <div class="api mgmt">Mgmt API</div>
                  </div>
                  <h2>Initialize Gateway Token</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X PUT http://localhost:8080/rest/v1/system/configs/authentication.gatewaytoken.key/ -u 'admin:admin' -H 'Content-Type: application/json' -d '{"value": "e61c6b2b78a674d19304c357a20f1d09"}'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP PUT
                        /rest/v1/system/configs/authentication.gatewaytoken.key
                        
                        Accept: application/hal+json
                        Authorization: Basic admin:admin
                        Content-Type: application/json
                        Body: 
                        {
                          "value": "e61C6b2B78A674d19304c357a20f1D09"
                        }
                      </code></pre>
                    </div>
                    <div class="api-response">
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 200 OK
                        {
                          "value": "e61C6b2B78A674d19304c357a20f1D09",
                          "lastModifiedAt": 1539682107943,
                          "lastModifiedBy": "admin",
                          "createdAt": 1539682107943,
                          "createdBy": "admin",
                          "global": false,
                          "_links": {
                            "self": {
                              "href":
                                "/rest/v1/system/configs/authentication.gatewaytoken.key"
                            }
                          }
                        }
                        </code></pre>
                    </div>
                  </div>
                  <blockquote class="verify">Verify in the System Configuration view of the UI that gateway token authentication is enabled and that the correct token is set.</blockquote>                  
                </section>

                <section>
                  <div class="current-page">
                    <div>Part 4, step 2</div>
                    <div class="api sim">Dev Sim</div>
                  </div>
                  <h2>Provisioning Many Devices</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Provision 15 "EMEA" devices</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X GET 'http://localhost:8083/start?name=emeadevice&amount=15&tenant=DEFAULT&api=ddi&endpoint=http://hawkbit:8080&gatewaytoken=e61c6b2b78a674d19304c357a20f1d09'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP GET
                        {deviceSimulatorBaseURL}/start
                        
                        Query Parameters:
                          name = emeadevice
                          amount = 15
                          tenant = DEFAULT
                          api = ddi
                          endpoint = http://hawkbit:8080
                          gatewaytoken = {gatewayToken}
                      </code></pre>
                    </div>
                    <div class="api-request">
                      <div>Provision 20 "APAC" devices</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X GET 'http://localhost:8083/start?name=apacdevice&amount=20&tenant=DEFAULT&api=ddi&endpoint=http://hawkbit:8080&gatewaytoken=e61c6b2b78a674d19304c357a20f1d09'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP GET
                        {deviceSimulatorBaseURL}/start
                        
                        Query Parameters:
                          name = apacdevice
                          amount = 20
                          tenant = DEFAULT
                          api = ddi
                          endpoint = http://hawkbit:8080
                          gatewaytoken = {gatewayToken}
                      </code></pre>
                    </div>
                    <div class="api-request">
                      <div>Provision 30 "Americas" devices</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X GET 'http://localhost:8083/start?name=amerdevice&amount=30&tenant=DEFAULT&api=ddi&endpoint=http://hawkbit:8080&gatewaytoken=e61c6b2b78a674d19304c357a20f1d09'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP GET
                        {deviceSimulatorBaseURL}/start
                        
                        Query Parameters:
                          name = amerdevice
                          amount = 30
                          tenant = DEFAULT
                          api = ddi
                          endpoint = http://hawkbit:8080
                          gatewaytoken = {gatewayToken}
                      </code></pre>
                    </div>
                    <div style="position:relative">
                      <blockquote style="position:absolute;bottom:0;right:0" class="verify">Verify in the Deployment Management view of the UI that the devices are present.</blockquote>
                    </div>
                  </div>                                    
                </section>

                <section>
                  <div class="current-page">
                    <div>Part 4, step 3</div>
                    <div class="api mgmt">Mgmt API</div>
                  </div>
                  <h2>Creating a Rollout</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X POST http://localhost:8080/rest/v1/rollouts -u 'admin:admin' -H 'Content-Type: application/json' -d '{"distributionSetId" : 1, "targetFilterQuery" : "description=='\''Plug and Play*'\''", "name" : "MyOS-Global-Rollout-1.0", "description" : "Global rollout of MyOS", "groups" : [{"name" : "EMEA_Devices", "description" : "Devices in EMEA", "targetFilterQuery" : "name==emea*", "successCondition" : {"condition" : "THRESHOLD", "expression" : "70"}, "successAction" : {"expression" : "", "action" : "NEXTGROUP"}, "errorAction" : {"expression" : "", "action" : "PAUSE"}, "errorCondition" : {"condition" : "THRESHOLD", "expression" : "20"}}, {"name" : "APAC_Devices", "description" : "Devices in APAC", "targetFilterQuery" : "name==apac*", "successCondition" : {"condition" : "THRESHOLD", "expression" : "50"}, "successAction" : {"expression" : "", "action" : "NEXTGROUP"}, "errorAction" : {"expression" : "", "action" : "PAUSE"}, "errorCondition" : {"condition" : "THRESHOLD", "expression" : "20"}}, {"name" : "AMER_Devices", "description" : "Devices in AMER", "targetFilterQuery" : "name==amer*", "successCondition" : {"condition" : "THRESHOLD", "expression" : "25"}, "successAction" : {"expression" : "", "action" : "NEXTGROUP"}, "errorAction" : {"expression" : "", "action" : "PAUSE"}, "errorCondition" : {"condition" : "THRESHOLD", "expression" : "20"}}]}'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP POST
                        /rest/v1/rollouts
                        
                        Accept: application/hal+json
                        Authorization: Basic admin:admin
                        Content-Type: application/json
                        Body:
                        {
                          "distributionSetId" : {distributionId},
                          "targetFilterQuery" : "description=='\''Plug and Play*'\''",
                          "name" : "MyOS-Global-Rollout-1.0",
                          "description" : "Global rollout of MyOS",
                          "groups" : [{
                            "name" : "EMEA_Devices",
                            "description" : "Devices in EMEA",                        HTTP GET
                        {deviceSimulatorBaseURL}/start
                        
                        Query Parameters:
                          name = emeadevice
                          amount = 15
                          tenant = DEFAULT
                          api = ddi
                          endpoint = http://hawkbit:8080
                          gatewaytoken = {gatewayToken}
                            
                            "targetFilterQuery" : "name==emea*",
                            "successCondition" : {
                              "condition" : "THRESHOLD",
                              "expression" : "70"
                            },
                            "successAction" : {
                              "expression" : "",
                              "action" : "NEXTGROUP"
                            },
                            "errorAction" : {
                              "expression" : "",
                              "action" : "PAUSE"
                            },
                            "errorCondition" : {
                              "condition" : "THRESHOLD",
                              "expression" : "20"
                            }
                          }, {
                            "name" : "APAC_Devices",
                            "description" : "Devices in APAC",
                            "targetFilterQuery" : "name==apac*",
                            [...]
                          }]
                        }'
                      </code></pre>
                      <!--<p>Creates a new rollouts with three groups for EMEA, APAC, and Americas.</p>-->
                    </div>
                    <div>
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 201 CREATED
                        {
                          [...]
                          "id": 1,
                          "name": "MyOS-Global-Rollout-1.0",
                          "description": "Global rollout of MyOS",
                          "targetFilterQuery": "description=='Plug and Play*'",
                          "distributionSetId": 1,
                          "status": "creating",
                          "totalTargets": 65,
                          "totalTargetsPerStatus": {
                            "running":0,
                            "notstarted": 65,
                            "scheduled": 0,
                            "cancelled": 0,
                            "finished": 0,
                            "error": 0
                          },
                          "_links": {
                            "start": {
                              "href": "/rest/v1/rollouts/1/start"
                            },
                            "pause": {
                              "href": "/rest/v1/rollouts/1/pause"
                            },
                            "resume": {
                              "href": "/rest/v1/rollouts/1/resume"
                            },
                            "groups": {
                              "href": "/rest/v1/rollouts/1/deploygroups?offset=0&limit=50{&sort,q}",
                              "templated":true
                            },
                            "self":{
                              "href":"/rest/v1/rollouts/1"
                            }
                          }
                        }
                      </code></pre>
                    </div>
                  </div>
                  <blockquote class="verify">Verify in the Rollout Management view of the UI that the rollout is present. Drill down into the rollout to review the three groups.</blockquote>                  
                </section>

                <section>
                  <div class="current-page">
                    <div>Part 4, step 4</div>
                    <div class="api mgmt">Mgmt API</div>
                  </div>
                  <h2>Starting the Rollout</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X POST http://localhost:8080/rest/v1/rollouts/1/start -u 'admin:admin'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP POST
                        /rest/v1/rollouts/{rolloutId}/start
                        
                        Authorization: Basic admin:admin
                      </code></pre>
                      <p>The rollout has been started. Keep in mind that the devices are being simulated by our Device Simulator. The Device Simulator sends deployment feedback messages on behalf of its devices.</p>
                    </div>
                    <div>
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 200 OK
                      </code></pre>
                    </div>
                  </div>
                  <blockquote class="verify">Verify in the Rollout Management view of the UI that the rollout is now being processed. Watch the progress bars of the rollout groups.</blockquote>                  
                </section>
                
                <section>
                  <div class="current-page">
                    <div>Part 4, step 5</div>
                    <div class="api mgmt">Mgmt API</div>
                  </div>
                  <h2>Creating a Target Filter for "EMEA"</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X POST http://localhost:8080/rest/v1/targetfilters -u 'admin:admin' -H 'Content-Type: application/json' -d '{"query" : "name==emeadevice*", "name" : "EMEA_Devices"}'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP POST
                        /rest/v1/targetfilters
                        
                        Accept: application/hal+json
                        Authorization: Basic admin:admin
                        Content-Type: application/json
                        Body:
                        {
                          "query": "name==emeadevice*",
                          "name" : "EMEA_Devices"
                        }                        
                      </code></pre>
                      <p>This will create a new filter which selects all devices matching the specified name prefix.</p>
                    </div>
                    <div>
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 201 CREATED
                        {
                          "id": 1,
                          [...]
                          "name": "EMEA_Devices",                        HTTP GET
                        {deviceSimulatorBaseURL}/start
                        
                        Query Parameters:
                          name = emeadevice
                          amount = 15
                          tenant = DEFAULT
                          api = ddi
                          endpoint = http://hawkbit:8080
                          gatewaytoken = {gatewayToken}
                          
                          "query": "name==emeadevice*",
                          "autoAssignDistributionSet": null,
                          "_links": {
                            "self": {
                              "href": "/rest/v1/targetfilters/1"
                            },
                            "autoAssignDS": {
                              "href": "/rest/v1/targetfilters/1/autoAssignDS"
                            }
                          }
                        }
                      </code></pre>
                    </div>
                  </div>
                  <blockquote class="verify">Verify in the Target Filter Management view of the UI that the filter is there. Select the filter and review the list of devices.</blockquote>                  
                  <blockquote class="verify">Create another filter via the UI. Play around with the auto completion function to get familiar with the FIQL syntax.</blockquote>                  
                </section>
                
                <section>
                  <div class="current-page">
                    <div>Part 4, step 6</div>
                    <div class="api mgmt">Mgmt API</div>
                  </div>
                  <h2>Setting an Auto Assignment Distribution</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X POST http://localhost:8080/rest/v1/targetfilters/1/autoAssignDS -u 'admin:admin' -H 'Content-Type: application/json' -d '{"id": "1"}'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP POST
                        /rest/v1/targetfilters/1/autoAssignDS
                        
                        Accept: application/hal+json
                        Authorization: Basic admin:admin
                        Content-Type: application/json
                        Body:
                        {
                          "id": "1"
                        }
                      </code></pre>
                      <p>Target filters with an "Auto Assignment Distribution Set" are resolved periodically. If the resolution result returns devices that do not have this distribution set assigned yet, hawkBit will sign it automatically.</p>
                    </div>
                    <div>
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 200 OK
                        {
                          "id": 1,
                          [...]
                          "name": "EMEA_Devices",
                          "query": "name==emeadevice*",
                          "autoAssignDistributionSet": 1,
                          "_links": {
                            "self": {
                              "href": "/rest/v1/targetfilters/1"
                            },
                            "autoAssignDS": {
                              "href": "/rest/v1/targetfilters/1/autoAssignDS"
                            }
                          }
                        }
                      </code></pre>
                    </div>
                  </div>
                  <blockquote class="verify">Verify in the Target Filter Management view of the UI that the filter is now associated with the distribution set. Let's now create some new devices matching our filter...</blockquote>                  
                </section>
                
                <section>
                  <div class="current-page">
                    <div>Part 4, step 7</div>
                    <div class="api sim">Dev Sim</div>
                  </div>
                  <h2>Creating Some More "EMEA Devices"</h2>
                  <div class="two-columns-eq">
                    <div class="api-request">
                      <div>Request</div>
                      <form class="copy-to-clipboard" onsubmit="return copyToClipboard(this.buffer)" action="#">
                  	    <textarea name="buffer">curl -i -X GET 'http://localhost:8083/start?name=emeadevice&amount=30&tenant=DEFAULT&api=ddi&endpoint=http://hawkbit:8080&gatewaytoken=e61c6b2b78a674d19304c357a20f1d09'</textarea>
                        <input type="submit" value="curl2clipboard">
                      </form>
                      <pre><code data-trim>
                        HTTP GET
                        {deviceSimulatorBaseURL}/start
                        
                        Query Parameters:
                          name = emeadevice
                          amount = 30
                          tenant = DEFAULT
                          api = ddi
                          endpoint = http://hawkbit:8080
                          gatewaytoken = {gatewayToken}
                      </code></pre>
                      <p>Once the target filter is executed for the next time, the devices are automatically updated with the distribution set of the filter.</p>
                    </div>
                    <div>
                      <div>Response</div>
                      <pre><code data-trim>
                        HTTP/1.1 200 OK
                        
                        Updated 30 DDI_HTTP connected targets!
                      </code></pre>
                    </div>
                  </div>
                  <blockquote class="verify">Verify in the Target Filter Management view of the UI that the filter captures the new devices. Watch the state of the devices.</blockquote>                  
                  <blockquote class="verify">Try to understand the difference between a "Rollout" and an "Auto Assignment"!</blockquote>
                </section>
                                
                <section>
                  <h1>Outlook</h1>
                  <ul>
                    <li>Support JDK 11</li>
                    <li>Vaadin 8</li>
                    <li>Custom key/value pairs for targets (<a href="https://github.com/eclipse/hawkbit/issues/737">#737</a>)</li>
                    <li>Small improvements of rollout management</li>
                    <li>JUnit 5, Java &gt;= 9 </li>
                  </ul>
                </section>

                <section data-background-image="https://images.unsplash.com/photo-1496449903678-68ddcb189a24?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=e37a38ee23569d8e72896968903cf67a&auto=format">
                  <div class="footer" style="position: fixed; bottom: 0; right: 0; text-align: right;">
                    Photo by <a href="https://unsplash.com/photos/ukzHlkoz1IE">Austin Chan</a> on <a href="https://unsplash.com">Unsplash</a>
                  </div>
                </section>
                
                <section>
                  <h1>Thank you</h1>
                  <div style="font-size: 1.5em; position:absolute; left:2em;">
                    <p><i class="fab fa-docker fa-fw"></i>&nbsp;<a href="https://hub.docker.com/u/hawkbit">hawkbit</a></p>
                    <p><i class="fab fa-gitter fa-fw"></i>&nbsp;<a href="https://gitter.im/eclipse/hawkbit">eclipse/hawkbit</a></p>
                    <p><i class="fab fa-github fa-fw"></i>&nbsp;<a href="https://github.com/eclipse/hawkbit">eclipse/hawkbit</a></p>
                    <p><i class="fa fa-book-open fa-fw"></i>&nbsp;<a href="http://www.eclipse.org/hawkbit">eclipse.org/hawkbit</a></p>
                  </div>
                </section>
                
            </div>
        </div>
        
        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.js"></script>

        <script>
            // Full list of configuration options available at:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: false,
                progress: true,
                history: true,
                center: true,

                transition: 'convex', // none/fade/slide/convex/concave/zoom

                // Optional reveal.js plugins
                dependencies: [{
                    src: 'lib/js/classList.js',
                    condition: function() {
                        return !document.body.classList;
                    }
                }, {
                    src: 'plugin/markdown/marked.js',
                    condition: function() {
                        return !!document.querySelector('[data-markdown]');
                    }
                }, {
                    src: 'plugin/markdown/markdown.js',
                    condition: function() {
                        return !!document.querySelector('[data-markdown]');
                    }
                }, {
                    src: 'plugin/highlight/highlight.js',
                    async: true,
                    condition: function() {
                        return !!document.querySelector('pre code');
                    },
                    callback: function() {
                        hljs.initHighlightingOnLoad();
                    }
                }, {
                    src: 'plugin/zoom-js/zoom.js',
                    async: true
                }, {
                    src: 'plugin/notes/notes.js',
                    async: true
                }]
            });

            Reveal.configure({
                slideNumber: true
            });

            const TARGET_TOKEN = "REPLACE_WITH_TARGET_TOKEN";
            function copyToClipboard(inputElem) {
            	var value = inputElem.value; 
            	if (value) {
                	var targetToken = localStorage.getItem(TARGET_TOKEN);
                	if (targetToken && value.indexOf(TARGET_TOKEN) >= 0) {
                		console.log("Injecting target token " + targetToken);
						inputElem.value = value.replace(TARGET_TOKEN, targetToken);                		                		
                	}
                	inputElem.select();
                	document.execCommand("copy");
            	}
            	return false;
            }
            
        </script>

    </body>

</html>
